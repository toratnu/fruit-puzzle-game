### ゲーム実装計画書

この計画書は `game_specification_v2.md` に準拠した落下物パズルゲームを、4つの段階に分けて順次開発するための手順を定義します。

#### **第1段階：コアメカニクスの確立**

*   **目的**:
    ゲームの根幹となる「ブロックを操作して消す」という基本的なサイクルを実装し、遊べる状態のプロトタイプを完成させる。
*   **主要実装項目**:
    1.  **ゲームボードの描画**: Canvas上にグリッドを描画する。
    2.  **ブロックの生成と落下**: ランダムなフルーツと形状でブロックを生成し、一定速度で落下させる。
    3.  **プレイヤー操作**: キーボード入力によるブロックの左右移動、回転、ソフトドロップ、ハードドロップを実装する。
    4.  **衝突判定**: ブロックが地面や他のブロックに接地したことを判定する。
    5.  **消去判定**: 同じフルーツが4つ以上繋がった場合にそれを検知し、盤面から消去する。
    6.  **ブロックの固定**: 接地したブロックを盤面に固定する。
    7.  **連鎖処理**: ブロック消去後に、宙に浮いたブロックを落下させる。
*   **主に対象となるモジュール**:
    *   `main.js`: ゲームループの初期化とエントリーポイント。
    *   `gameEngine.js`: ゲーム状態の基本的な管理。
    *   `board.js`: Canvasの描画、グリッドと固定ブロックの管理。
    *   `block.js`: 落下中ブロックのデータ構造、回転ロジック。
    *   `inputHandler.js`: キーボード入力の受付。
    *   `collision.js`: 落下、接地、壁との衝突判定。
    *   `matchChecker.js`: フルーツの連結判定と消去処理。
*   **完了時の確認項目**:
    *   ブロックが落下し、キーボードで操作できる。
    *   ブロックを4つ繋げると消え、その上のブロックが落下する。
    *   ブロックが画面上部まで積み上がると、コンソールログ等でゲームオーバーが通知される。

---

#### **第2段階：ゲームサイクルの完成とUI・演出の基本実装**

*   **目的**:
    ゲームの開始から終了までの一連の流れを完成させ、スコアやレベルといったUI情報をプレイヤーに提示する。基本的なエフェクトとサウンドを導入し、ゲームとしての体裁を整える。
*   **主要実装項目**:
    1.  **画面遷移**: スタート画面、ゲーム画面、ゲームオーバー画面の表示と切り替えを実装する。
    2.  **ゲームモードの分岐**: ノーマルモードとスコアアタックモードの基本的なロジック（制限時間、初期レベルなど）を実装する。
    3.  **スコアとレベル管理**: スコア計算と表示、レベルアップの仕組みを実装する。
    4.  **UIパネルの更新**: スコア、レベル、残り時間などの情報を画面に表示・更新する。
    5.  **基本的な視覚エフェクト**: ブロックの消去エフェクト、連鎖・レベルアップ時のテキスト表示を実装する。
    6.  **基本的なサウンド再生**: BGM、ブロックの着地・消去・レベルアップ時の効果音を実装する。
*   **主に対象となるモジュール**:
    *   `ui/screenManager.js`: 画面全体の表示切り替え。
    *   `ui/panelUpdater.js`: スコアやレベル等のUIテキスト更新。
    *   `game/scoreManager.js`: スコア計算、レベル管理。
    *   `game/timer.js`: 制限時間の管理。
    *   `game/effect.js`: パーティクルやテキストポップアップなどの視覚演出。
    *   `ui/soundManager.js`: BGMと効果音の再生管理。
*   **完了時の確認項目**:
    *   スタート画面からゲームを開始し、ゲームオーバー画面に遷移できる。
    *   スコアやレベルが画面に表示され、正しく更新される。
    *   ブロックを消した時やレベルアップ時に、簡単なエフェクトと効果音が発生する。

---

#### **第3段階：「爽快感」強化機能の実装**

*   **目的**:
    仕様書v2の核となる「フィーバーモード」と「特殊ブロック」を実装し、ゲームの戦略性と爽快感を飛躍的に向上させる。
*   **主要実装項目**:
    1.  **フィーバーゲージ**: UIにフィーバーゲージを追加し、フルーツ消去によってゲージが溜まるロジックを実装する。
    2.  **フィーバーモード**: ゲージが満タンになったらフィーバーモードに突入。モード中の専用BGM、背景変化、消去条件緩和（3つで消える）、スコア2倍、時間停止の各効果を実装する。
    3.  **特殊ブロック（ボム・レインボー）**:
        *   それぞれの出現条件に基づき、盤面に特殊ブロックを生成する。
        *   ボムフルーツの爆発効果、レインボーフルーツのワイルドカード機能を実装する。
    4.  **追加ボーナス**: 全消しボーナス、同時消しボーナスの判定とスコア加算ロジックを実装する。
    5.  **専用演出**: フィーバー突入、ボム爆発、全消し達成時の派手な視覚エフェクトと効果音を追加する。
*   **主に対象となるモジュール**:
    *   `game/gameEngine.js`: フィーバーモードの状態管理。
    *   `game/scoreManager.js`: フィーバーボーナス、全消しボーナス等の計算。
    *   `ui/panelUpdater.js`: フィーバーゲージの描画・更新。
    *   `game/block.js`: 特殊ブロックの定義と出現ロジック。
    *   `game/matchChecker.js`: 特殊ブロックの効果処理、フィーバー中の消去条件変更。
    *   `game/effect.js`, `ui/soundManager.js`: 新機能に対応する演出とサウンドの追加。
*   **完了時の確認項目**:
    *   フルーツを消すとフィーバーゲージが溜まり、満タンでフィーバーモードに突入する。
    *   フィーバーモード中は、ブロックが3つで消え、スコアが2倍になる。
    *   ボムフルーツ、レインボーフルーツが低確率で出現し、それぞれが正しく機能する。

---

#### **第4段階：UI/UXの改善と最終仕上げ**

*   **目的**:
    プレイヤーがより快適に遊べるようにUI/UXを改善し、ゲーム全体の品質を向上させる。最終的なデバッグとバランス調整を行い、完成度を高める。
*   **主要実装項目**:
    1.  **ゴーストブロック**: 操作中ブロックの着地点を予測して、半透明のガイドを盤面に表示する。
    2.  **NEXT表示拡張**: 次のブロックだけでなく、2手先のブロックまで表示する。
    3.  **レスポンシブ対応**: スマートフォンなどのモバイル端末でも快適にプレイできるよう、画面レイアウトを調整し、モバイル用操作ボタンを実装する。
    4.  **遊び方画面の実装**: ゲームルールを説明する画面を作成する。
    5.  **ハイスコア保存**: `localStorage` を使用してハイスコアを保存し、スタート画面に表示する。
    6.  **総合調整**:
        *   ゲームバランス（落下速度、スコア倍率、フィーバーゲージの溜まりやすさ等）の最終調整。
        *   全機能のデバッグとバグ修正。
        *   演出やサウンドのタイミング調整。
*   **主に対象となるモジュール**:
    *   `game/board.js`: ゴーストブロックの描画ロジック。
    *   `ui/panelUpdater.js`: NEXT2表示の実装。
    *   `style/main.css`: レスポンシブデザイン対応。
    *   `ui/inputHandler.js`: モバイル用タッチ操作の追加。
    *   `ui/screenManager.js`: 遊び方画面の制御。
    *   `main.js`: ハイスコアの読み書き処理。
*   **完了時の確認項目**:
    *   ゴーストブロックとNEXT2表示により、操作の補助が機能している。
    *   スマートフォンのブラウザでアクセスした際に、レイアウトが崩れず、タッチ操作でプレイできる。
    *   ハイスコアが正しく保存され、ゲームを再起動しても表示される。
    *   全ての機能が仕様書通りに動作し、明らかな不具合がない。